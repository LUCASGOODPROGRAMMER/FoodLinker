@page "/restaurante/cadastrar-restaurante"
@using RedRidersNew.Components.Layout.LayoutRestaurante
@using RedRidersNew.Models
@inject RestauranteDAO restauranteDAO
@inject NavigationManager Navigation
@layout MainLayoutRestaurante

<PageTitle>Cadastro de Restaurante</PageTitle>

@if (!string.IsNullOrEmpty(erro))
{
    <div class="alert alert-danger">@erro</div>
}

<div class="container py-4">
    <NavBarRestaurante />

    <EditForm Model="_novoRestaurante" OnValidSubmit="Salvar" FormName="CadastroRestaurante" class="card p-4 mb-4 shadow-sm">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <h4 class="mb-3 fw-semibold border-bottom pb-2">Cadastro de Restaurante</h4>

        <div class="row g-3">
            <div class="col-md-12">
                <label class="form-label fw-semibold">Nome Fantasia</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Nome_Fantasia_Restaurante" />
            </div>

            <div class="col-md-12">
                <label class="form-label fw-semibold">Razão Social</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Razao_Social_Restaurante" />
            </div>

            <div class="col-md-12">
                <label class="form-label fw-semibold">Imagem</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Imagem_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">CNPJ</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Cnpj_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">CEP</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Cep_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Rua</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Rua_Restaurante" />
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">Número</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Numero_Restaurante" />
            </div>

            <div class="col-md-9">
                <label class="form-label fw-semibold">Complemento</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Complemento_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Bairro</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Bairro_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Cidade</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Cidade_Restaurante" />
            </div>

            <div class="col-md-4">
                <label class="form-label fw-semibold">Estado</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Estado_Restaurante" />
            </div>

            <div class="col-md-12">
                <label class="form-label fw-semibold">Ponto de Referência</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Ponto_De_Referencia_Restaurante" />
            </div>

            <div class="col-md-9">
                <label class="form-label fw-semibold">Nome do Dono</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Nome_Do_Dono_Restaurante" />
            </div>

            <div class="col-md-3">
                <label class="form-label fw-semibold">CPF do Dono</label>
                <InputText class="form-control" @bind-Value="_novoRestaurante.Cpf_Do_Dono_Restaurante" />
            </div>
        </div>

        <div class="mt-4 text-end">
            <button type="submit" class="btn btn-soft-primary px-4">Cadastrar</button>
        </div>
    </EditForm>
</div>

@code {
    private string? erro = null;
    private Restaurante _novoRestaurante = new Restaurante(); // Garantindo que nunca é nulo

    private void Salvar()
    {
        try
        {
            restauranteDAO.CadastrarRestaurante(_novoRestaurante);

            _novoRestaurante = new Restaurante(); // limpa formulário
            Navigation.NavigateTo("/restaurante/gerenciar-restaurantes");
        }
        catch (Exception ex)
        {
            erro = ex.Message;
        }
    }
}
